<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Prestadores de Salud</title>
    <h:outputStylesheet library="css" name="prestadorSalud.css" />
</h:head>
<h:body>
    <div class="page-wrapper">
        <div class="page-header">
            <h1>Prestadores de Salud</h1>
            <p class="subtitle">Administre el alta, edición y la búsqueda con la estética del portal HCEN.</p>
        </div>

        <h:messages id="globalMessages" globalOnly="true" styleClass="faces-messages"
                    infoClass="info" errorClass="error" warnClass="warn" />

        <div class="section-grid">
            <h:form id="formCrear" styleClass="card card-create">
                <h2>Crear Prestador de Salud</h2>
                <p class="lead">Complete el formulario para habilitar un nuevo prestador dentro del ecosistema HCEN.</p>
                <h:panelGrid columns="3" styleClass="form-grid">
                    <h:outputLabel for="nombre" value="Nombre:" />
                    <h:inputText id="nombre" value="#{prestadorSaludBean.nuevoPrestador.nombre}" required="true" />
                    <h:message for="nombre" styleClass="error" />

                    <h:outputLabel for="rut" value="RUT:" />
                    <h:inputText id="rut" value="#{prestadorSaludBean.nuevoPrestador.rut}" required="true" />
                    <h:message for="rut" styleClass="error" />

                    <h:outputLabel for="schema" value="Nombre Schema:" />
                    <h:inputText id="schema" value="#{prestadorSaludBean.nuevoPrestador.nombreSchema}" />
                    <h:message for="schema" styleClass="error" />

                    <h:outputLabel for="estado" value="Activo:" />
                    <h:selectBooleanCheckbox id="estado" value="#{prestadorSaludBean.nuevoPrestador.estado}" />
                    <h:message for="estado" styleClass="error" />

                    <h:outputLabel for="contacto" value="Contacto Mail:" />
                    <h:inputText id="contacto" value="#{prestadorSaludBean.nuevoPrestador.contactoMail}" />
                    <h:message for="contacto" styleClass="error" />

                    <h:outputLabel for="tipo" value="Tipo:" />
                    <h:inputText id="tipo" value="#{prestadorSaludBean.nuevoPrestador.tipo}" />
                    <h:message for="tipo" styleClass="error" />
                </h:panelGrid>

                <h:commandButton value="Crear" action="#{prestadorSaludBean.crear}" styleClass="btn btn-primario">
                    <f:ajax execute="@form" render=":formTabla:tablaContainer :formCrear :globalMessages" />
                </h:commandButton>
            </h:form>

            <h:form id="formEditar" styleClass="card card-edit">
                <h2>Modificar Prestador de Salud</h2>
                <p class="lead">Actualice los datos del prestador seleccionado o cancele para volver al listado.</p>

                <h:panelGroup layout="block" rendered="#{not prestadorSaludBean.modoEdicion}" styleClass="card-placeholder">
                    <strong>Seleccione un prestador de salud</strong>
                    <span>Utilice el listado para elegir un registro y habilitar la edición.</span>
                </h:panelGroup>

                <h:panelGrid id="editarContainer" columns="3" styleClass="form-grid" rendered="true">
                    <h:outputLabel for="editNombre" value="Nombre:" />
                    <h:inputText id="editNombre" value="#{prestadorSaludBean.prestadorEnEdicion.nombre}"
                                 required="#{prestadorSaludBean.modoEdicion}"
                                 disabled="#{not prestadorSaludBean.modoEdicion}" />
                    <h:message for="editNombre" styleClass="error" />

                    <h:outputLabel for="editRut" value="RUT:" />
                    <h:inputText id="editRut" value="#{prestadorSaludBean.prestadorEnEdicion.rut}" disabled="true" />
                    <h:message for="editRut" styleClass="error" />

                    <h:outputLabel for="editSchema" value="Nombre Schema:" />
                    <h:inputText id="editSchema" value="#{prestadorSaludBean.prestadorEnEdicion.nombreSchema}" disabled="true" />
                    <h:message for="editSchema" styleClass="error" />

                    <h:outputLabel for="editEstado" value="Activo:" />
                    <h:selectBooleanCheckbox id="editEstado" value="#{prestadorSaludBean.prestadorEnEdicion.estado}"
                                             disabled="#{not prestadorSaludBean.modoEdicion}" />
                    <h:message for="editEstado" styleClass="error" />

                    <h:outputLabel for="editContacto" value="Contacto Mail:" />
                    <h:inputText id="editContacto" value="#{prestadorSaludBean.prestadorEnEdicion.contactoMail}"
                                 disabled="#{not prestadorSaludBean.modoEdicion}" />
                    <h:message for="editContacto" styleClass="error" />

                    <h:outputLabel for="editTipo" value="Tipo:" />
                    <h:inputText id="editTipo" value="#{prestadorSaludBean.prestadorEnEdicion.tipo}"
                                 disabled="#{not prestadorSaludBean.modoEdicion}" />
                    <h:message for="editTipo" styleClass="error" />
                </h:panelGrid>

                <h:panelGroup layout="block" styleClass="card-actions" rendered="#{prestadorSaludBean.modoEdicion}">
                    <h:commandButton value="Guardar cambios" action="#{prestadorSaludBean.actualizar}"
                                     styleClass="btn btn-primario">
                        <f:ajax execute="@form" render=":formTabla:tablaContainer :formEditar :globalMessages" />
                    </h:commandButton>
                    <h:commandButton value="Cancelar" action="#{prestadorSaludBean.cancelarEdicion}"
                                     styleClass="btn btn-secundario">
                        <f:ajax execute="@this" render=":formEditar" />
                    </h:commandButton>
                </h:panelGroup>
            </h:form>

            <h:form id="formBuscar" styleClass="card card-search">
                <h2>Buscar Prestadores</h2>
                <p class="lead">Filtre el listado por RUT o por nombre para encontrar prestadores específicos.</p>
                <h:panelGrid columns="4" styleClass="form-grid">
                    <h:outputLabel for="buscarRut" value="Buscar por RUT:" />
                    <h:inputText id="buscarRut" value="#{prestadorSaludBean.buscarRut}" />

                    <h:outputLabel for="buscarNombre" value="o por Nombre:" />
                    <h:inputText id="buscarNombre" value="#{prestadorSaludBean.buscarNombre}" />

                    <h:commandButton value="Buscar" action="#{prestadorSaludBean.buscar}" styleClass="btn btn-primario">
                        <f:ajax execute="@form" render=":formTabla:tablaContainer" />
                    </h:commandButton>

                    <h:commandButton value="Limpiar" action="#{prestadorSaludBean.limpiarBusqueda}"
                                     styleClass="btn btn-secundario">
                        <f:ajax render=":formTabla:tablaContainer :formBuscar" />
                    </h:commandButton>
                </h:panelGrid>
            </h:form>
        </div>

        <h:form id="formTabla" styleClass="card tabla-card">
            <h2>Listado de Prestadores</h2>
            <p class="lead">Revise el estado de los prestadores registrados y gestione acciones rápidas.</p>
            <h:panelGroup id="tablaContainer" layout="block" styleClass="tabla-scroll">
                <h:dataTable id="tablaPrestadores" value="#{prestadorSaludBean.prestadoresFiltrados}" var="p"
                             styleClass="tabla-prestadores">

                    <h:column><f:facet name="header">ID</f:facet>#{p.tenantId}</h:column>
                    <h:column><f:facet name="header">Schema</f:facet>#{p.nombreSchema}</h:column>
                    <h:column><f:facet name="header">Nombre</f:facet>#{p.nombre}</h:column>
                    <h:column><f:facet name="header">RUT</f:facet>#{p.rut}</h:column>
                    <h:column>
                        <f:facet name="header">Estado</f:facet>
                        <h:outputText value="#{p.estado ? 'Activo' : 'Inactivo'}" />
                    </h:column>
                    <h:column><f:facet name="header">Contacto</f:facet>#{p.contactoMail}</h:column>
                    <h:column><f:facet name="header">Tipo</f:facet>#{p.tipo}</h:column>
                    <h:column><f:facet name="header">Creado</f:facet>#{p.fechaCreacion}</h:column>
                    <h:column><f:facet name="header">Modificado</f:facet>#{p.fechaModificacion}</h:column>

                    <h:column>
                        <f:facet name="header">Acciones</f:facet>
                        <h:panelGroup styleClass="acciones-tabla">
                            <h:commandButton value="Modificar" action="#{prestadorSaludBean.prepararEdicion(p)}"
                                             styleClass="btn btn-secundario">
                                <f:ajax execute="@this" render=":formEditar :globalMessages" />
                            </h:commandButton>
                            <h:commandButton value="Desactivar" action="#{prestadorSaludBean.desactivar(p.rut)}"
                                             rendered="#{p.estado}" styleClass="btn btn-secundario">
                                <f:ajax execute="@form" render=":formTabla:tablaContainer :globalMessages" />
                            </h:commandButton>
                            <h:commandButton value="Activar" action="#{prestadorSaludBean.activar(p.rut)}"
                                             rendered="#{not p.estado}" styleClass="btn btn-primario">
                                <f:ajax execute="@form" render=":formTabla:tablaContainer :globalMessages" />
                            </h:commandButton>
                        </h:panelGroup>
                    </h:column>

                    <f:facet name="footer">
                        <h:outputText value="Sin resultados." rendered="#{empty prestadorSaludBean.prestadoresFiltrados}" />
                    </f:facet>

                </h:dataTable>
            </h:panelGroup>
        </h:form>
    </div>
</h:body>
</html>